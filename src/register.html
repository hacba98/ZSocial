<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
	<head>
		<title> Z-Social </title>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		
		<script language="javascript">
			addEventListener("keyup", function(event) {
				if (event.keyCode === 13) {
					event.preventDefault();
					document.getElementById("registerBtn").click();
				}
			});
			
			function register(){
				var username = document.registerForm.username.value;
				var password = document.registerForm.password.value;
				var repassword = document.registerForm.repassword.value;
				var name = document.registerForm.Name.value;
				var gender = document.registerForm.gender.value;
				var phonenumber = document.registerForm.phonenumber.value;
				var birth = document.registerForm.birth.value;
				
				// filter empty params
				if(!username || !password || !repassword || !name || !gender || !phonenumber || !birth){
					alert("You need to fill in all data");
					return;
				}
				
				// filter password and re-password not matches
				if (password !== repassword){
					alert("Your confirm password did not match with your password");
					return;
				}
				
				var flag = true;
				var url = "/profile/register/";
				var params = "username=" + username + "&password=" + password+ "&repassword=" + repassword + "&name=" + name + "&birth=" + birth + "&gender=" + gender + "&phonenumber=" + phonenumber;
				
				var xmlHttp = new XMLHttpRequest();
				xmlHttp.open('POST', url, true);
				xmlHttp.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
				xmlHttp.onreadystatechange = function() {//Call a function when the state changes.
					if(xmlHttp.readyState == 4 && xmlHttp.status == 200) {
					    alert("Your accout is create !", xmlHttp.responseText);
					    location.replace("/");
					} else if (xmlHttp.status == 404 && flag){
					    flag = false;
                                            if (xmlHttp.getResponseHeader("valid") === "duplicate_username"){
                                                alert("this username already exist , choose new one please!!");
                                            }else{
                                                alert("Error 500 not work");
                                            }
					}
				}
				xmlHttp.send(params);
			}
		</script>
	</head>
	<body>
		<Center>
			<form name="registerForm" onsubmit="register()">
				<table border="0" bgcolor="#CCCCFF" cellspacing="1" cellpadding="3" width="300">
					<tr>
						<td align="left" colspan="2" width="275"><b><font size="5" color="#000080">Login</font></b></td>
					</tr>
					<tr>
						<td align="right" width="81"><b><font color="#000080">UserName:</font></b></td>
						<td width="184"><input type="text" name="username" size="20" value="" /></td>
					</tr>
					<tr>
						<td align="right" width="81"><b><font color="#000080">Password:</font></b></td>
						<td width="184"><input type="password" name="password" size="20" value="" /></td>
					</tr>
					<tr>
						<td align="right" width="81"><b><font color="#000080">confirm :</font></b></td>
						<td width="184"><input type="password" name="repassword" size="20" value="" /></td>
					</tr>
					<tr>
						<td align="right" width="81"><b><font color="#000080">Your Name:</font></b></td>
						<td width="184"><input type="text" name="Name" size="20" value="" /></td>
					</tr>
					<tr>
						<td align="right" width="81"><b><font color="#000080">Gender:</font></b></td>
						<td width="184"><input type="radio" name="gender" value="Nam"> 
								<input type="radio" name="gender" value="Nu"></td>
					</tr>
					<tr>
						<td align="right" width="81"><b><font color="#000080">PhoneNumber:</font></b></td>
						<td width="184"><input type="text" name="phonenumber" size="20" value="" /></td>
					</tr>
					<tr>
						<td align="right" width="81"><font color="#000080">Birth:</font><b></b></td>
						<td width="200"><input type="date" name="birth" size="15" value="" /></td>
					</tr>
					<tr>
						<td colspan="2" align="center" width="275"><input type="button" id="registerBtn" name="a1" value="Register" onclick="register()"></td>
					</tr>
					
				</table>
			</form>
		</center>
	</body>
</html>
